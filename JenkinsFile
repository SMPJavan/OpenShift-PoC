node {
    def app
	
    stage('Clone repository') {
        /* Let's make sure we have the repository cloned to our workspace */

        checkout scm
    }
	
	stage('Get deployable') {
		maven() {
			bat "mvn clean install -U -Ddeployable.group.id=$deployableGroupId -Ddeployable.artifact.id=$deployableArtifactId -Ddeployable.version=$deployableVersion -Ddeployable.type=$deployableType"
		}
	}

    stage('Build image') {
        /* This builds the actual image; synonymous to
         * docker build on the command line */		
			bat "docker build . -t  $deployableArtifactId-$deployableVersion"
    }
	
	stage('Deploy image') {
			bat "docker login --username=pusher $openshiftDockerRegistry -p $openshiftDeployerPassword"
			bat "docker tag $deployableArtifactId:$deployableVersion $openshiftDockerRegistry/pushed/$deployableArtifactId-$environment:latest"
			bat "docker push $openshiftDockerRegistry/pushed/$deployableArtifactId-$environment:latest"
	}
}